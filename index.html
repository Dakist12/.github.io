<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선생님 어디계세요?</title>
    <!-- CSS 파일 연결 -->
    <link href="styles/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <!-- 원 div -->
    <div id="circle">Offline</div>

    <!-- 자바스크립트 파일 연결 -->
    <script src="scripts/main.js" type="module"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDD19tQFgggIdLLxqu0we8MfDtLFCx1PRs",
            authDomain: "where-is-teacher-d3e3c.firebaseapp.com",
            projectId: "where-is-teacher-d3e3c",
            storageBucket: "where-is-teacher-d3e3c.appspot.com",
            messagingSenderId: "39623109681",
            appId: "1:39623109681:web:0d895bb51f5eacca8d7910",
            measurementId: "G-5LD2HBD0YZ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 기존 자바스크립트 실행 코드
        window.onload = async function() {
            const circle = document.getElementById('circle');
            const docRef = doc(db, 'statuses', 'circleState');

            // Firestore에서 저장된 상태 확인
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const savedState = docSnap.data().state;
                if (savedState === 'Online') {
                    circle.textContent = 'Online';
                    circle.style.backgroundColor = 'green';
                } else {
                    circle.textContent = 'Offline';
                    circle.style.backgroundColor = 'red';
                }
            } else {
                circle.textContent = 'Offline';
                circle.style.backgroundColor = 'red';
            }

            // 클릭할 때마다 상태 변경 및 Firestore에 저장
            circle.addEventListener('click', async function() {
                if (circle.textContent.trim() === 'Offline') {
                    circle.textContent = 'Online';
                    circle.style.backgroundColor = 'green';
                    await setDoc(docRef, { state: 'Online' });
                } else {
                    circle.textContent = 'Offline';
                    circle.style.backgroundColor = 'red';
                    await setDoc(docRef, { state: 'Offline' });
                }
            });
        };
    </script>
</body>
</html>
